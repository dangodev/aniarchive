# Migration `20200209213738-ghibli`

This migration has been generated by Drew Powers at 2/9/2020, 9:37:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "aniarchive-v1"."Film" (
    "id" text  NOT NULL ,
    "image" text  NOT NULL ,
    "releaseYear" integer  NOT NULL DEFAULT 0,
    "studio" text   ,
    "title" text  NOT NULL DEFAULT '',
    "titleEN" text  NOT NULL DEFAULT '',
    "titleJP" text  NOT NULL DEFAULT '',
    "trailer" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."AnimationSequence" (
    "film" text  NOT NULL ,
    "id" text  NOT NULL ,
    "image" text  NOT NULL ,
    "notes" text   ,
    "timestampEnd" integer   ,
    "timestampStart" integer   ,
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Image" (
    "copyright" text   ,
    "id" text  NOT NULL ,
    "release" text   ,
    "title" text  NOT NULL DEFAULT '',
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Person" (
    "alias" text   ,
    "birthDay" integer   ,
    "birthMonth" integer   ,
    "birthYear" integer   ,
    "country" text  NOT NULL DEFAULT 'AU',
    "deathDay" integer   ,
    "deathMonth" integer   ,
    "deathYear" integer   ,
    "description" text   ,
    "firstName" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "image" text   ,
    "kanji" text   ,
    "lastName" text  NOT NULL DEFAULT '',
    "website" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Release" (
    "country" text  NOT NULL DEFAULT 'AU',
    "film" text  NOT NULL ,
    "format" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "notes" text   ,
    "releaseDay" integer   ,
    "releaseMonth" integer   ,
    "releaseYear" integer  NOT NULL DEFAULT 0,
    "runtime" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Studio" (
    "city" text   ,
    "country" text  NOT NULL DEFAULT 'AU',
    "foundedYear" integer  NOT NULL DEFAULT 0,
    "id" text  NOT NULL ,
    "image" text   ,
    "name" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."_FilmComposers" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_FilmDirectors" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_FilmWriters" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_AnimationSequenceToPerson" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_PersonToStudio" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE UNIQUE INDEX "Film.title" ON "aniarchive-v1"."Film"("title")

CREATE UNIQUE INDEX "Film.titleJP" ON "aniarchive-v1"."Film"("titleJP")

CREATE UNIQUE INDEX "Film.titleEN" ON "aniarchive-v1"."Film"("titleEN")

CREATE UNIQUE INDEX "Image.url" ON "aniarchive-v1"."Image"("url")

CREATE UNIQUE INDEX "Studio.name" ON "aniarchive-v1"."Studio"("name")

CREATE UNIQUE INDEX "_FilmComposers_AB_unique" ON "aniarchive-v1"."_FilmComposers"("A","B")

CREATE UNIQUE INDEX "_FilmDirectors_AB_unique" ON "aniarchive-v1"."_FilmDirectors"("A","B")

CREATE UNIQUE INDEX "_FilmWriters_AB_unique" ON "aniarchive-v1"."_FilmWriters"("A","B")

CREATE UNIQUE INDEX "_AnimationSequenceToPerson_AB_unique" ON "aniarchive-v1"."_AnimationSequenceToPerson"("A","B")

CREATE UNIQUE INDEX "_PersonToStudio_AB_unique" ON "aniarchive-v1"."_PersonToStudio"("A","B")

ALTER TABLE "aniarchive-v1"."Film" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Film" ADD FOREIGN KEY ("studio") REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."AnimationSequence" ADD FOREIGN KEY ("film") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."AnimationSequence" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Image" ADD FOREIGN KEY ("release") REFERENCES "aniarchive-v1"."Release"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Person" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Release" ADD FOREIGN KEY ("film") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Studio" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."_FilmComposers" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmComposers" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmDirectors" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmDirectors" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmWriters" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmWriters" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_AnimationSequenceToPerson" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."AnimationSequence"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_AnimationSequenceToPerson" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_PersonToStudio" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_PersonToStudio" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200209213738-ghibli
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,140 @@
+generator prisma {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRESQL_URL")
+}
+
+enum Country {
+  AU
+  BR
+  CA
+  CN
+  ES
+  FR
+  GB
+  IT
+  JP
+  MX
+  NZ
+  TR
+  UA
+  US
+}
+
+model Film {
+  ///comment A unique ID for this film
+  id                 String              @id
+  ///comment Title of the film in the original language
+  title              String              @unique
+  ///comment Japanese title
+  titleJP            String              @unique
+  ///comment English title
+  titleEN            String              @unique
+  ///comment Initial release year of the film
+  releaseYear        Int
+  ///comment Main image for the film
+  image              Image
+  ///comment Releases of the film
+  releases           Release[]
+  ///comment Studio that produced the film
+  studio             Studio?
+  ///comment URL to watch the trailer
+  trailer            String?
+  ///comment Animation sequences for the film
+  animationSequences AnimationSequence[]
+  ///comment The composers of the film
+  composers          Person[]            @relation(name: "FilmComposers")
+  ///comment The directors of the film
+  directors          Person[]            @relation(name: "FilmDirectors")
+  ///comment The writers of the film
+  writers            Person[]            @relation(name: "FilmWriters")
+}
+
+model AnimationSequence {
+  id             String   @default(cuid()) @id
+  artists        Person[]
+  film           Film
+  image          Image
+  notes          String?
+  timestampStart Int?
+  timestampEnd   Int?
+  url            String
+}
+
+model Image {
+  id        String  @default(cuid()) @id
+  copyright String?
+  title     String
+  url       String  @unique
+}
+
+model Person {
+  ///comment A unique ID for this person
+  id                 String              @id
+  ///comment Last name of this person
+  lastName           String
+  ///comment First name of this person
+  firstName          String
+  ///comment This personâ€™s name in Kanji (Japanese only)
+  kanji              String?
+  ///comment Alias, usually if a person is better known by this
+  alias              String?
+  ///comment Image of this person
+  image              Image?
+  ///comment A short bio for this person
+  description        String?
+  ///comment Country this person is associated with
+  country            Country
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthYear          Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthMonth         Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthDay           Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathYear          Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathMonth         Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathDay           Int?
+  ///comment Website of this person
+  website            String?
+  ///comment Films this person animated
+  animationSequences AnimationSequence[]
+  ///comment Films this person directed
+  directed           Film[]              @relation(name: "FilmDirectors")
+  ///comment Films this person wrote
+  wrote              Film[]              @relation(name: "FilmWriters")
+  ///comment Films this person composed the music for
+  composed           Film[]              @relation(name: "FilmComposers")
+  ///comment Studios this person founded
+  founded            Studio[]
+}
+
+model Release {
+  id           String  @default(cuid()) @id
+  film         Film
+  images       Image[] @relation(name: "ReleaseImages")
+  releaseYear  Int
+  releaseMonth Int?
+  releaseDay   Int?
+  country      Country
+  ///comment Format for the release (e.g. DVD / BluRay / Television)
+  format       String
+  notes        String?
+  runtime      Int
+}
+
+model Studio {
+  id          String   @id
+  name        String   @unique
+  image       Image?
+  foundedYear Int
+  films       Film[]
+  city        String?
+  country     Country
+  founders    Person[]
+}
```


