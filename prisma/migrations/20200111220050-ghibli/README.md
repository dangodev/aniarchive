# Migration `20200111220050-ghibli`

This migration has been generated by Drew Powers at 1/11/2020, 10:00:50 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "aniarchive-v1"."Film" (
  "id" text  NOT NULL  ,
  "languageDub" text []   ,
  "languageSub" text []   ,
  "releaseYear" integer  NOT NULL DEFAULT 0 ,
  "title" text  NOT NULL DEFAULT '' ,
  "titleEN" text  NOT NULL DEFAULT '' ,
  "titleJP" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."FrameSequence" (
  "id" text  NOT NULL  ,
  "notes" text  NOT NULL DEFAULT '' ,
  "order" integer  NOT NULL DEFAULT 0 ,
  "video" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."Frame" (
  "id" text  NOT NULL  ,
  "keyframe" boolean  NOT NULL DEFAULT false ,
  "notes" text  NOT NULL DEFAULT '' ,
  "order" integer  NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."Image" (
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  "url" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."Person" (
  "alias" text    ,
  "birthDay" integer    ,
  "birthMonth" integer    ,
  "birthYear" integer    ,
  "deathDay" integer    ,
  "deathMonth" integer    ,
  "deathYear" integer    ,
  "description" text    ,
  "firstName" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "kanji" text    ,
  "lastName" text  NOT NULL DEFAULT '' ,
  "location" text    ,
  "website" text    ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."Release" (
  "country" text  NOT NULL DEFAULT 'AU' ,
  "format" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "notes" text    ,
  "region" text  NOT NULL DEFAULT '' ,
  "releaseDay" integer    ,
  "releaseMonth" integer    ,
  "releaseYear" integer  NOT NULL DEFAULT 0 ,
  "runtime" integer  NOT NULL DEFAULT 0 ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."Studio" (
  "city" text    ,
  "country" text  NOT NULL DEFAULT 'AU' ,
  "foundedYear" integer  NOT NULL DEFAULT 0 ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "aniarchive-v1"."_FilmComposers" (
  "A" text  NOT NULL  REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE
);

CREATE TABLE "aniarchive-v1"."_FilmDirectors" (
  "A" text  NOT NULL  REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE
);

CREATE TABLE "aniarchive-v1"."_StudioFounders" (
  "A" text  NOT NULL  REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE,
  "B" text  NOT NULL  REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE CASCADE
);

ALTER TABLE "aniarchive-v1"."Film" ADD COLUMN "image" text  NOT NULL  REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT,
ADD COLUMN "person" text    REFERENCES "aniarchive-v1"."Person"("id") ON DELETE SET NULL,
ADD COLUMN "studio" text    REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE SET NULL;

ALTER TABLE "aniarchive-v1"."FrameSequence" ADD COLUMN "film" text  NOT NULL  REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT;

ALTER TABLE "aniarchive-v1"."Frame" ADD COLUMN "artist" text  NOT NULL  REFERENCES "aniarchive-v1"."Person"("id") ON DELETE RESTRICT,
ADD COLUMN "frameSequence" text    REFERENCES "aniarchive-v1"."FrameSequence"("id") ON DELETE SET NULL,
ADD COLUMN "image" text  NOT NULL  REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT;

ALTER TABLE "aniarchive-v1"."Image" ADD COLUMN "release" text    REFERENCES "aniarchive-v1"."Release"("id") ON DELETE SET NULL;

ALTER TABLE "aniarchive-v1"."Person" ADD COLUMN "film" text    REFERENCES "aniarchive-v1"."Film"("id") ON DELETE SET NULL,
ADD COLUMN "frameSequence" text    REFERENCES "aniarchive-v1"."FrameSequence"("id") ON DELETE SET NULL;

ALTER TABLE "aniarchive-v1"."Release" ADD COLUMN "film" text  NOT NULL  REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT;

CREATE UNIQUE INDEX "Film.title" ON "aniarchive-v1"."Film"("title")

CREATE UNIQUE INDEX "Film.titleJP" ON "aniarchive-v1"."Film"("titleJP")

CREATE UNIQUE INDEX "Film.titleEN" ON "aniarchive-v1"."Film"("titleEN")

CREATE UNIQUE INDEX "Studio.name" ON "aniarchive-v1"."Studio"("name")

CREATE UNIQUE INDEX "_FilmComposers_AB_unique" ON "aniarchive-v1"."_FilmComposers"("A","B")

CREATE UNIQUE INDEX "_FilmDirectors_AB_unique" ON "aniarchive-v1"."_FilmDirectors"("A","B")

CREATE UNIQUE INDEX "_StudioFounders_AB_unique" ON "aniarchive-v1"."_StudioFounders"("A","B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200111220050-ghibli
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,143 @@
+generator photon {
+  provider = "photonjs"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRES_URL")
+}
+
+enum Country {
+  AU
+  BR
+  CA
+  CN
+  ES
+  FR
+  GB
+  IT
+  JP
+  MX
+  NZ
+  TR
+  UA
+  US
+}
+
+model Film {
+  ///comment A unique ID for this film
+  id             String          @id
+  ///comment Animators for this film
+  animators      Person[]        @relation(name: "FilmAnimators")
+  ///comment The composers of the film
+  composers      Person[]        @relation(name: "FilmComposers")
+  ///comment The directors of the film
+  directors      Person[]        @relation(name: "FilmDirectors")
+  ///comment Animation frame sequences for the film
+  frameSequences FrameSequence[]
+  ///comment Main image for the film
+  image          Image
+  ///comment Voice acting languages for the film
+  languageDub    String[]
+  ///comment Subtitle languages for the film
+  languageSub    String[]
+  ///comment Releases of the film
+  releases       Release[]
+  ///comment Initial release year of the film
+  releaseYear    Int
+  ///comment Studio that produced the film
+  studio         Studio?
+  ///comment Title of the film in the original language
+  title          String          @unique
+  ///comment Japanese title
+  titleJP        String          @unique
+  ///comment English title
+  titleEN        String          @unique
+}
+
+model FrameSequence {
+  id      String   @default(cuid()) @id
+  artists Person[] @relation(name: "FrameSequenceArtists")
+  film    Film
+  frames  Frame[]
+  notes   String
+  order   Int
+  video   String
+}
+
+model Frame {
+  id       String  @default(cuid()) @id
+  artist   Person
+  image    Image
+  keyframe Boolean
+  notes    String
+  order    Int
+}
+
+model Image {
+  id   String @default(cuid()) @id
+  name String
+  url  String
+}
+
+model Person {
+  ///comment A unique ID for this person
+  id          String   @id
+  ///comment Alias, usually if a person is better known by this
+  alias       String?
+  ///comment Films this person animated
+  animated    Film[]   @relation(name: "FilmArtists")
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthMonth  Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthDay    Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthYear   Int?
+  ///comment Films this person composed the music for
+  composed    Film[]   @relation(name: "FilmComposers")
+  ///comment Films this person directed
+  directed    Film[]   @relation(name: "FilmDirectors")
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathDay    Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathMonth  Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathYear   Int?
+  ///comment A short bio for this person
+  description String?
+  ///comment First name of this person
+  firstName   String
+  ///comment This personâ€™s name in Kanji (Japanese only)
+  founded     Studio[] @relation(name: "StudioFounders")
+  kanji       String?
+  ///comment Last name of this person
+  lastName    String
+  ///comment Location of this person
+  location    String?
+  ///comment Website of this person
+  website     String?
+}
+
+model Release {
+  id           String  @default(cuid()) @id
+  country      Country
+  film         Film
+  format       String
+  images       Image[]
+  notes        String?
+  region       String
+  releaseDay   Int?
+  releaseMonth Int?
+  releaseYear  Int
+  runtime      Int
+}
+
+model Studio {
+  id          String   @id
+  city        String?
+  country     Country
+  films       Film[]
+  foundedYear Int
+  founders    Person[] @relation(name: "StudioFounders")
+  name        String   @unique
+}
```


