# Migration `20200422230409-ghibli`

This migration has been generated by Drew Powers at 4/22/2020, 11:04:09 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Country" AS ENUM ('AU', 'BR', 'CA', 'CN', 'ES', 'FR', 'GB', 'IT', 'JP', 'MX', 'NZ', 'TR', 'UA', 'US');

CREATE TABLE "public"."Film" (
    "id" text  NOT NULL ,
    "imageId" text  NOT NULL ,
    "releaseYear" integer  NOT NULL ,
    "studioId" text   ,
    "title" text  NOT NULL ,
    "titleEN" text  NOT NULL ,
    "titleJP" text  NOT NULL ,
    "trailer" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."AnimationSequence" (
    "filmId" text  NOT NULL ,
    "id" text  NOT NULL ,
    "imageId" text  NOT NULL ,
    "notes" text   ,
    "timestampEnd" integer   ,
    "timestampStart" integer   ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Image" (
    "copyright" text   ,
    "id" text  NOT NULL ,
    "releaseId" text   ,
    "title" text  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Person" (
    "alias" text   ,
    "birthDay" integer   ,
    "birthMonth" integer   ,
    "birthYear" integer   ,
    "country" "Country" NOT NULL ,
    "deathDay" integer   ,
    "deathMonth" integer   ,
    "deathYear" integer   ,
    "description" text   ,
    "firstName" text  NOT NULL ,
    "id" text  NOT NULL ,
    "imageId" text   ,
    "kanji" text   ,
    "lastName" text  NOT NULL ,
    "website" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Release" (
    "country" "Country" NOT NULL ,
    "filmId" text  NOT NULL ,
    "format" text  NOT NULL ,
    "id" text  NOT NULL ,
    "notes" text   ,
    "releaseDay" integer   ,
    "releaseMonth" integer   ,
    "releaseYear" integer  NOT NULL ,
    "runtime" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Studio" (
    "city" text   ,
    "country" "Country" NOT NULL ,
    "foundedYear" integer  NOT NULL ,
    "id" text  NOT NULL ,
    "imageId" text   ,
    "name" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_FilmComposers" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_FilmDirectors" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_FilmWriters" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_AnimationSequenceToPerson" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "public"."_PersonToStudio" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE UNIQUE INDEX "Film.title" ON "public"."Film"("title")

CREATE UNIQUE INDEX "Film.titleJP" ON "public"."Film"("titleJP")

CREATE UNIQUE INDEX "Film.titleEN" ON "public"."Film"("titleEN")

CREATE UNIQUE INDEX "Image.url" ON "public"."Image"("url")

CREATE UNIQUE INDEX "Studio.name" ON "public"."Studio"("name")

CREATE UNIQUE INDEX "_FilmComposers_AB_unique" ON "public"."_FilmComposers"("A","B")

CREATE  INDEX "_FilmComposers_B_index" ON "public"."_FilmComposers"("B")

CREATE UNIQUE INDEX "_FilmDirectors_AB_unique" ON "public"."_FilmDirectors"("A","B")

CREATE  INDEX "_FilmDirectors_B_index" ON "public"."_FilmDirectors"("B")

CREATE UNIQUE INDEX "_FilmWriters_AB_unique" ON "public"."_FilmWriters"("A","B")

CREATE  INDEX "_FilmWriters_B_index" ON "public"."_FilmWriters"("B")

CREATE UNIQUE INDEX "_AnimationSequenceToPerson_AB_unique" ON "public"."_AnimationSequenceToPerson"("A","B")

CREATE  INDEX "_AnimationSequenceToPerson_B_index" ON "public"."_AnimationSequenceToPerson"("B")

CREATE UNIQUE INDEX "_PersonToStudio_AB_unique" ON "public"."_PersonToStudio"("A","B")

CREATE  INDEX "_PersonToStudio_B_index" ON "public"."_PersonToStudio"("B")

ALTER TABLE "public"."Film" ADD FOREIGN KEY ("imageId")REFERENCES "public"."Image"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Film" ADD FOREIGN KEY ("studioId")REFERENCES "public"."Studio"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."AnimationSequence" ADD FOREIGN KEY ("filmId")REFERENCES "public"."Film"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AnimationSequence" ADD FOREIGN KEY ("imageId")REFERENCES "public"."Image"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Image" ADD FOREIGN KEY ("releaseId")REFERENCES "public"."Release"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Person" ADD FOREIGN KEY ("imageId")REFERENCES "public"."Image"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Release" ADD FOREIGN KEY ("filmId")REFERENCES "public"."Film"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Studio" ADD FOREIGN KEY ("imageId")REFERENCES "public"."Image"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmComposers" ADD FOREIGN KEY ("A")REFERENCES "public"."Film"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmComposers" ADD FOREIGN KEY ("B")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmDirectors" ADD FOREIGN KEY ("A")REFERENCES "public"."Film"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmDirectors" ADD FOREIGN KEY ("B")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmWriters" ADD FOREIGN KEY ("A")REFERENCES "public"."Film"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_FilmWriters" ADD FOREIGN KEY ("B")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AnimationSequenceToPerson" ADD FOREIGN KEY ("A")REFERENCES "public"."AnimationSequence"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AnimationSequenceToPerson" ADD FOREIGN KEY ("B")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PersonToStudio" ADD FOREIGN KEY ("A")REFERENCES "public"."Person"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_PersonToStudio" ADD FOREIGN KEY ("B")REFERENCES "public"."Studio"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200422230409-ghibli
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,148 @@
+datasource db {
+  provider = "postgres"
+  url      = env("POSTGRESQL_URL")
+}
+
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+enum Country {
+  AU
+  BR
+  CA
+  CN
+  ES
+  FR
+  GB
+  IT
+  JP
+  MX
+  NZ
+  TR
+  UA
+  US
+}
+
+model Film {
+  // /comment A unique ID for this film
+  id                 String              @id
+  // /comment Title of the film in the original language
+  title              String              @unique
+  // /comment Japanese title
+  titleJP            String              @unique
+  // /comment English title
+  titleEN            String              @unique
+  // /comment Initial release year of the film
+  releaseYear        Int
+  // /comment Main image for the film
+  image              Image               @relation(fields: [imageId], references: [id])
+  imageId            String
+  // /comment Releases of the film
+  releases           Release[]
+  // /comment Studio that produced the film
+  studio             Studio?             @relation(fields: [studioId], references: [id])
+  studioId           String?
+  // /comment URL to watch the trailer
+  trailer            String?
+  // /comment Animation sequences for the film
+  animationSequences AnimationSequence[]
+  // /comment The composers of the film
+  composers          Person[]            @relation("FilmComposers", references: [id])
+  // /comment The directors of the film
+  directors          Person[]            @relation("FilmDirectors", references: [id])
+  // /comment The writers of the film
+  writers            Person[]            @relation("FilmWriters", references: [id])
+}
+
+model AnimationSequence {
+  id             String   @default(cuid()) @id
+  artists        Person[] @relation(references: [id])
+  film           Film     @relation(fields: [filmId], references: [id])
+  filmId         String
+  image          Image    @relation(fields: [imageId], references: [id])
+  imageId        String
+  notes          String?
+  timestampStart Int?
+  timestampEnd   Int?
+  url            String
+}
+
+model Image {
+  id        String  @default(cuid()) @id
+  copyright String?
+  title     String
+  url       String  @unique
+  releaseId String?
+}
+
+model Person {
+  // /comment A unique ID for this person
+  id                 String              @id
+  // /comment Last name of this person
+  lastName           String
+  // /comment First name of this person
+  firstName          String
+  // /comment This personâ€™s name in Kanji (Japanese only)
+  kanji              String?
+  // /comment Alias, usually if a person is better known by this
+  alias              String?
+  // /comment Image of this person
+  image              Image?              @relation(fields: [imageId], references: [id])
+  imageId            String?
+  // /comment A short bio for this person
+  description        String?
+  // /comment Country this person is associated with
+  country            Country
+  // /comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthYear          Int?
+  // /comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthMonth         Int?
+  // /comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthDay           Int?
+  // /comment Death days are split into day/month/year separately because we may not know all parts!
+  deathYear          Int?
+  // /comment Death days are split into day/month/year separately because we may not know all parts!
+  deathMonth         Int?
+  // /comment Death days are split into day/month/year separately because we may not know all parts!
+  deathDay           Int?
+  // /comment Website of this person
+  website            String?
+  // /comment Films this person animated
+  animationSequences AnimationSequence[] @relation(references: [id])
+  // /comment Films this person directed
+  directed           Film[]              @relation("FilmDirectors", references: [id])
+  // /comment Films this person wrote
+  wrote              Film[]              @relation("FilmWriters", references: [id])
+  // /comment Films this person composed the music for
+  composed           Film[]              @relation("FilmComposers", references: [id])
+  // /comment Studios this person founded
+  founded            Studio[]            @relation(references: [id])
+}
+
+model Release {
+  id           String  @default(cuid()) @id
+  film         Film    @relation(fields: [filmId], references: [id])
+  filmId       String
+  images       Image[] @relation("ReleaseImages")
+  releaseYear  Int
+  releaseMonth Int?
+  releaseDay   Int?
+  country      Country
+  // /comment Format for the release (e.g. DVD / BluRay / Television)
+  format       String
+  notes        String?
+  runtime      Int
+}
+
+model Studio {
+  id          String   @id
+  name        String   @unique
+  image       Image?   @relation(fields: [imageId], references: [id])
+  imageId     String?
+  foundedYear Int
+  films       Film[]
+  city        String?
+  country     Country
+  founders    Person[] @relation(references: [id])
+}
```


