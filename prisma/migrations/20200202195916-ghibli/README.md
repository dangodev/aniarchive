# Migration `20200202195916-ghibli`

This migration has been generated by Drew Powers at 2/2/2020, 7:59:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "aniarchive-v1"."Film" (
    "id" text  NOT NULL ,
    "image" text  NOT NULL ,
    "person" text   ,
    "releaseYear" integer  NOT NULL DEFAULT 0,
    "studio" text   ,
    "title" text  NOT NULL DEFAULT '',
    "titleEN" text  NOT NULL DEFAULT '',
    "titleJP" text  NOT NULL DEFAULT '',
    "trailer" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."FrameSequence" (
    "film" text  NOT NULL ,
    "id" text  NOT NULL ,
    "image" text  NOT NULL ,
    "notes" text  NOT NULL DEFAULT '',
    "timestampEnd" integer   ,
    "timestampStart" integer   ,
    "video" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Image" (
    "copyright" text   ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "release" text   ,
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Person" (
    "alias" text   ,
    "birthDay" integer   ,
    "birthMonth" integer   ,
    "birthYear" integer   ,
    "country" text  NOT NULL DEFAULT 'AU',
    "deathDay" integer   ,
    "deathMonth" integer   ,
    "deathYear" integer   ,
    "description" text   ,
    "film" text   ,
    "firstName" text  NOT NULL DEFAULT '',
    "frameSequence" text   ,
    "id" text  NOT NULL ,
    "image" text   ,
    "kanji" text   ,
    "lastName" text  NOT NULL DEFAULT '',
    "website" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Release" (
    "country" text  NOT NULL DEFAULT 'AU',
    "film" text  NOT NULL ,
    "format" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "notes" text   ,
    "region" text  NOT NULL DEFAULT '',
    "releaseDay" integer   ,
    "releaseMonth" integer   ,
    "releaseYear" integer  NOT NULL DEFAULT 0,
    "runtime" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."Studio" (
    "city" text   ,
    "country" text  NOT NULL DEFAULT 'AU',
    "foundedYear" integer  NOT NULL DEFAULT 0,
    "id" text  NOT NULL ,
    "image" text   ,
    "name" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "aniarchive-v1"."_FilmComposers" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_FilmDirectors" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "aniarchive-v1"."_StudioFounders" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE UNIQUE INDEX "Film.title" ON "aniarchive-v1"."Film"("title")

CREATE UNIQUE INDEX "Film.titleJP" ON "aniarchive-v1"."Film"("titleJP")

CREATE UNIQUE INDEX "Film.titleEN" ON "aniarchive-v1"."Film"("titleEN")

CREATE UNIQUE INDEX "Image.url" ON "aniarchive-v1"."Image"("url")

CREATE UNIQUE INDEX "Studio.name" ON "aniarchive-v1"."Studio"("name")

CREATE UNIQUE INDEX "_FilmComposers_AB_unique" ON "aniarchive-v1"."_FilmComposers"("A","B")

CREATE UNIQUE INDEX "_FilmDirectors_AB_unique" ON "aniarchive-v1"."_FilmDirectors"("A","B")

CREATE UNIQUE INDEX "_StudioFounders_AB_unique" ON "aniarchive-v1"."_StudioFounders"("A","B")

ALTER TABLE "aniarchive-v1"."Film" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Film" ADD FOREIGN KEY ("studio") REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Film" ADD FOREIGN KEY ("person") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."FrameSequence" ADD FOREIGN KEY ("film") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."FrameSequence" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Image" ADD FOREIGN KEY ("release") REFERENCES "aniarchive-v1"."Release"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Person" ADD FOREIGN KEY ("film") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Person" ADD FOREIGN KEY ("frameSequence") REFERENCES "aniarchive-v1"."FrameSequence"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Person" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."Release" ADD FOREIGN KEY ("film") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE RESTRICT

ALTER TABLE "aniarchive-v1"."Studio" ADD FOREIGN KEY ("image") REFERENCES "aniarchive-v1"."Image"("id") ON DELETE SET NULL

ALTER TABLE "aniarchive-v1"."_FilmComposers" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmComposers" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmDirectors" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Film"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_FilmDirectors" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_StudioFounders" ADD FOREIGN KEY ("A") REFERENCES "aniarchive-v1"."Person"("id") ON DELETE CASCADE

ALTER TABLE "aniarchive-v1"."_StudioFounders" ADD FOREIGN KEY ("B") REFERENCES "aniarchive-v1"."Studio"("id") ON DELETE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200202195916-ghibli
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,137 @@
+generator prisma {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRESQL_URL")
+}
+
+enum Country {
+  AU
+  BR
+  CA
+  CN
+  ES
+  FR
+  GB
+  IT
+  JP
+  MX
+  NZ
+  TR
+  UA
+  US
+}
+
+model Film {
+  ///comment A unique ID for this film
+  id             String          @id
+  ///comment Animators for this film
+  animators      Person[]        @relation(name: "FilmAnimators")
+  ///comment The composers of the film
+  composers      Person[]        @relation(name: "FilmComposers")
+  ///comment The directors of the film
+  directors      Person[]        @relation(name: "FilmDirectors")
+  ///comment Animation frame sequences for the film
+  frameSequences FrameSequence[] @relation(name: "FilmFrameSequence")
+  ///comment Main image for the film
+  image          Image           @relation(name: "FilmImage")
+  ///comment Releases of the film
+  releases       Release[]
+  ///comment Initial release year of the film
+  releaseYear    Int
+  ///comment Studio that produced the film
+  studio         Studio?
+  ///comment Title of the film in the original language
+  title          String          @unique
+  ///comment Japanese title
+  titleJP        String          @unique
+  ///comment English title
+  titleEN        String          @unique
+  ///comment URL to watch the trailer
+  trailer        String?
+}
+
+model FrameSequence {
+  id             String   @default(cuid()) @id
+  artists        Person[] @relation(name: "FrameSequenceArtists")
+  film           Film     @relation(name: "FilmFrameSequence")
+  image          Image    @relation(name: "FrameSequenceImage")
+  notes          String
+  timestampStart Int?
+  timestampEnd   Int?
+  video          String
+}
+
+model Image {
+  id        String  @default(cuid()) @id
+  copyright String?
+  name      String
+  url       String  @unique
+}
+
+model Person {
+  ///comment A unique ID for this person
+  id          String   @id
+  ///comment Alias, usually if a person is better known by this
+  alias       String?
+  ///comment Films this person animated
+  animated    Film[]   @relation(name: "FilmArtists")
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthMonth  Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthDay    Int?
+  ///comment Birthdays are split into day/month/year separately because we may not know all parts!
+  birthYear   Int?
+  ///comment Country this person is associated with
+  country     Country
+  ///comment Films this person composed the music for
+  composed    Film[]   @relation(name: "FilmComposers")
+  ///comment Films this person directed
+  directed    Film[]   @relation(name: "FilmDirectors")
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathDay    Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathMonth  Int?
+  ///comment Death days are split into day/month/year separately because we may not know all parts!
+  deathYear   Int?
+  ///comment A short bio for this person
+  description String?
+  ///comment First name of this person
+  firstName   String
+  founded     Studio[] @relation(name: "StudioFounders")
+  ///comment Image of this person
+  image       Image?   @relation(name: "PersonImage")
+  ///comment This personâ€™s name in Kanji (Japanese only)
+  kanji       String?
+  ///comment Last name of this person
+  lastName    String
+  ///comment Website of this person
+  website     String?
+}
+
+model Release {
+  id           String  @default(cuid()) @id
+  country      Country
+  film         Film
+  format       String
+  images       Image[] @relation(name: "ReleaseImages")
+  notes        String?
+  region       String
+  releaseDay   Int?
+  releaseMonth Int?
+  releaseYear  Int
+  runtime      Int
+}
+
+model Studio {
+  id          String   @id
+  city        String?
+  country     Country
+  films       Film[]
+  foundedYear Int
+  founders    Person[] @relation(name: "StudioFounders")
+  image       Image?   @relation(name: "StudioImage")
+  name        String   @unique
+}
```


